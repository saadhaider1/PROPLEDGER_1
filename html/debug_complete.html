<!DOCTYPE html>
<html>
<head>
    <title>Complete Agent Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Complete Agent Display Debug</h1>
    
    <div class="test-section">
        <h2>1. Database Check</h2>
        <div id="db-result">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>2. API Endpoint Test</h2>
        <div id="api-result">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>3. JavaScript Execution Test</h2>
        <div id="js-result">Loading...</div>
    </div>
    
    <div class="test-section">
        <h2>4. DOM Manipulation Test</h2>
        <div id="dom-test">
            <div class="managers-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Test grid for agent cards -->
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Starting complete debug...');

        // Test 1: Database via PHP endpoint
        async function testDatabase() {
            try {
                const response = await fetch('../php/check_agents_simple.php');
                const text = await response.text();
                document.getElementById('db-result').innerHTML = `<pre class="success">${text}</pre>`;
                return true;
            } catch (error) {
                document.getElementById('db-result').innerHTML = `<div class="error">Error: ${error.message}</div>`;
                return false;
            }
        }

        // Test 2: API Endpoint
        async function testAPI() {
            try {
                console.log('Testing API endpoint...');
                const response = await fetch('../managers/get_agents.php');
                console.log('API Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                console.log('Raw API response:', text);
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (parseError) {
                    throw new Error(`JSON Parse Error: ${parseError.message}. Raw response: ${text}`);
                }
                
                document.getElementById('api-result').innerHTML = `
                    <div class="success">‚úÖ API Success</div>
                    <p>Status: ${response.status}</p>
                    <p>Success: ${data.success}</p>
                    <p>Agent Count: ${data.count}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                return data;
            } catch (error) {
                console.error('API Test failed:', error);
                document.getElementById('api-result').innerHTML = `<div class="error">‚ùå API Error: ${error.message}</div>`;
                return null;
            }
        }

        // Test 3: JavaScript Agent Loading
        async function testAgentLoading() {
            try {
                const data = await testAPI();
                if (!data || !data.success) {
                    throw new Error('API test failed');
                }

                const managersGrid = document.querySelector('.managers-grid');
                if (!managersGrid) {
                    throw new Error('Managers grid not found');
                }

                // Clear existing cards
                managersGrid.innerHTML = '';

                if (data.agents && data.agents.length > 0) {
                    data.agents.forEach((agent, index) => {
                        const agentCard = document.createElement('div');
                        agentCard.style.cssText = `
                            border: 1px solid #ddd;
                            padding: 15px;
                            border-radius: 8px;
                            background: white;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        `;
                        
                        const initials = agent.full_name.split(' ').map(name => name.charAt(0)).join('').substring(0, 2).toUpperCase();
                        const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57'];
                        const avatarColor = colors[index % colors.length];
                        
                        agentCard.innerHTML = `
                            <div style="width: 60px; height: 60px; border-radius: 50%; background: ${avatarColor}; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
                                <span style="color: white; font-weight: bold; font-size: 1.2rem;">${initials}</span>
                            </div>
                            <h3 style="margin: 10px 0; text-align: center;">${agent.full_name}</h3>
                            <p style="text-align: center; color: #666;">Real Estate Agent</p>
                            <p style="text-align: center; margin: 5px 0;"><strong>City:</strong> ${agent.city}</p>
                            <p style="text-align: center; margin: 5px 0;"><strong>Specialization:</strong> ${agent.specialization}</p>
                            <p style="text-align: center; margin: 5px 0;"><strong>Status:</strong> ${agent.status}</p>
                            <div style="display: flex; gap: 5px; margin-top: 15px;">
                                <button style="flex: 1; padding: 8px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">üìπ Call</button>
                                <button style="flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">üí¨ Message</button>
                            </div>
                        `;
                        
                        managersGrid.appendChild(agentCard);
                    });

                    document.getElementById('js-result').innerHTML = `
                        <div class="success">‚úÖ JavaScript Success</div>
                        <p>Successfully created ${data.agents.length} agent cards</p>
                        <p>Grid found: Yes</p>
                        <p>Cards added: ${managersGrid.children.length}</p>
                    `;
                } else {
                    throw new Error('No agents in API response');
                }
            } catch (error) {
                console.error('JS Test failed:', error);
                document.getElementById('js-result').innerHTML = `<div class="error">‚ùå JavaScript Error: ${error.message}</div>`;
            }
        }

        // Run all tests
        async function runAllTests() {
            console.log('Running all tests...');
            
            // Test 1: Database
            await testDatabase();
            
            // Test 2 & 3: API and JS (combined)
            await testAgentLoading();
        }

        // Start tests when page loads
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
</body>
</html>
